<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>WaterHero v6.0 â€” æ¯æ—¥å–æ°´ç´€éŒ„ï¼ˆæ‰‹æ©Ÿå–®é å„ªåŒ–ç‰ˆï¼‰</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
  :root { -webkit-tap-highlight-color: transparent; }
  * { box-sizing: border-box; }
  html,body {
    height:100%;
    margin:0;
    padding:0;
    background: linear-gradient(180deg,#eef8ff,#ffffff);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "PingFang TC", "Microsoft JhengHei", sans-serif;
  }
  .card {
    @apply bg-white rounded-2xl shadow p-4 mb-4 w-full max-w-md mx-auto;
  }
</style>
</head>

<body class="flex flex-col items-center justify-start p-2">
  <!-- Header -->
  <h1 class="text-2xl font-bold mt-2 mb-4 text-blue-700">ğŸ’§ WaterHero v6.0</h1>

  <!-- æ°´ç“¶å‘½å -->
  <div class="card flex flex-col items-center">
    <label class="text-sm mb-2 font-semibold">æˆ‘çš„æ°´ç“¶åç¨±</label>
    <div class="flex w-full gap-2">
      <input id="bottleName" class="flex-1 border rounded px-2 py-1 text-center" placeholder="è¼¸å…¥æ°´ç“¶åç¨±" />
      <button id="saveBottleName" class="bg-blue-500 text-white px-3 py-1 rounded">ç¢ºå®š</button>
    </div>
    <div id="bottleNameDisplay" class="mt-2 text-sm text-gray-600"></div>
  </div>

  <!-- ä»Šæ—¥å–æ°´ç´€éŒ„ -->
  <div class="card text-center">
    <p class="font-semibold mb-2">ä»Šæ—¥ç¸½é‡ï¼š<span id="todayTotal">0</span> ml</p>
    <div class="flex justify-center gap-2 mb-2">
      <input id="waterInput" type="number" class="w-24 border rounded text-center" placeholder="ml" />
      <button id="addWater" class="bg-blue-600 text-white px-3 py-1 rounded">åŠ å…¥</button>
      <button id="undoWater" class="bg-gray-400 text-white px-3 py-1 rounded">æ’¤å›</button>
    </div>
    <div class="h-3 bg-gray-200 rounded-full overflow-hidden mb-2">
      <div id="progressBar" class="h-3 bg-blue-500 transition-all duration-300" style="width:0%"></div>
    </div>
    <p>ç›®æ¨™ï¼š<span id="goalDisplay">2000</span> ml</p>
  </div>

  <!-- èŠ±åœ’ -->
  <div class="card">
    <p class="font-semibold mb-2">ğŸŒ¼ æˆ‘çš„èŠ±åœ’</p>
    <div id="garden" class="flex flex-wrap gap-2 justify-center text-2xl"></div>
  </div>

  <!-- æé†’è¨­å®šèˆ‡ç›®æ¨™ -->
  <div class="card flex flex-wrap items-center justify-center gap-2">
    <div class="flex items-center gap-1">
      <label class="text-sm">æé†’(åˆ†):</label>
      <input id="reminderInput" type="number" class="w-24 border rounded px-2 py-1 text-center" placeholder="60" />
      <button id="setReminder" class="bg-green-500 text-white px-3 py-1 rounded">è¨­å®š</button>
    </div>

    <div class="flex items-center gap-1">
      <label class="text-sm">ç›®æ¨™(ml):</label>
      <input id="goalInput" type="number" class="w-16 border rounded px-2 py-1 text-center" placeholder="2000" />
      <button id="setGoal" class="bg-yellow-500 text-white px-3 py-1 rounded">ç¢ºèª</button>
    </div>

    <div class="w-full text-center mt-2 text-sm text-gray-600">
      å€’æ•¸ï¼š<span id="timerDisplay">--:--</span>
    </div>
  </div>

  <!-- å¾½ç« èˆ‡ç­‰ç´š -->
  <div class="card text-center">
    <p>ğŸ… ä»Šæ—¥é”æ¨™å¾½ç« ï¼š<span id="badgeCount">0</span></p>
    <p>ğŸ”¥ é€£çºŒé”æ¨™ï¼š<span id="streak">0</span> å¤©</p>
    <p>ğŸ§´ æ°´ç“¶ç­‰ç´šï¼šLv.<span id="bottleLevel">1</span></p>
  </div>

  <!-- Chart -->
  <div class="card">
    <p class="font-semibold mb-2">ğŸ“Š ä»Šæ—¥å–æ°´åˆ†å¸ƒ</p>
    <canvas id="dailyChart" height="150"></canvas>
  </div>

  <!-- æ§åˆ¶ -->
  <div class="card flex flex-wrap items-center justify-center gap-2">
    <button id="resetToday" class="bg-red-400 text-white px-3 py-1 rounded">é‡è¨­ä»Šå¤©</button>
    <button id="resetAll" class="bg-red-600 text-white px-3 py-1 rounded">é‡è¨­å…¨éƒ¨</button>
  </div>

<script>
let todayTotal = 0, goal = 2000, waterHistory = [], flowers = 0, badgeCount = 0, streak = 0, level = 1;
let lastInput = 0, reminderTimer = null, reminderSeconds = 0;
const garden = document.getElementById('garden');
const todayTotalEl = document.getElementById('todayTotal');
const progressBar = document.getElementById('progressBar');
const goalDisplay = document.getElementById('goalDisplay');
const badgeEl = document.getElementById('badgeCount');
const streakEl = document.getElementById('streak');
const levelEl = document.getElementById('bottleLevel');
const timerDisplay = document.getElementById('timerDisplay');

// åŠ æ°´
document.getElementById('addWater').onclick = () => {
  const val = Number(document.getElementById('waterInput').value);
  if(!val || val<=0) return alert('è«‹è¼¸å…¥æ­£ç¢ºçš„æ•¸å­—');
  lastInput = val;
  todayTotal += val;
  waterHistory.push({time: new Date().toLocaleTimeString(), value: val});
  updateUI();
  document.getElementById('waterInput').value='';
};

// æ’¤å›
document.getElementById('undoWater').onclick = ()=>{
  if(lastInput===0) return alert('æ²’æœ‰å¯æ’¤å›çš„ç´€éŒ„');
  todayTotal -= lastInput;
  if(todayTotal<0) todayTotal=0;
  lastInput=0;
  updateUI();
};

// è¨­å®šæé†’
document.getElementById('setReminder').onclick = ()=>{
  const mins = Number(document.getElementById('reminderInput').value);
  if(!mins || mins<=0) return alert('è«‹è¼¸å…¥åˆ†é˜æ•¸');
  if(reminderTimer) clearInterval(reminderTimer);
  reminderSeconds = mins*60;
  reminderTimer = setInterval(()=>{
    if(reminderSeconds<=0){
      clearInterval(reminderTimer);
      alert('â° å–æ°´æ™‚é–“åˆ°ï¼');
    } else {
      reminderSeconds--;
      const m = String(Math.floor(reminderSeconds/60)).padStart(2,'0');
      const s = String(reminderSeconds%60).padStart(2,'0');
      timerDisplay.textContent=`${m}:${s}`;
    }
  },1000);
};

// è¨­å®šç›®æ¨™
document.getElementById('setGoal').onclick = ()=>{
  const val = Number(document.getElementById('goalInput').value);
  if(!val || val<=0) return alert('è«‹è¼¸å…¥æœ‰æ•ˆç›®æ¨™');
  goal = val;
  goalDisplay.textContent=goal;
  updateUI();
};

// é‡è¨­ä»Šå¤©
document.getElementById('resetToday').onclick = ()=>{
  if(confirm('ç¢ºå®šé‡è¨­ä»Šå¤©è³‡æ–™ï¼Ÿ')){
    todayTotal=0; lastInput=0; waterHistory=[]; updateUI();
  }
};

// é‡è¨­å…¨éƒ¨
document.getElementById('resetAll').onclick = ()=>{
  const c = prompt('è¼¸å…¥ yes ä»¥ç¢ºèªé‡è¨­æ‰€æœ‰è³‡æ–™');
  if(c==='yes'){ location.reload(); localStorage.clear(); }
};

// å„²å­˜æ°´ç“¶åç¨±
document.getElementById('saveBottleName').onclick = ()=>{
  const name = document.getElementById('bottleName').value.trim();
  if(!name) return alert('è«‹è¼¸å…¥åç¨±');
  localStorage.setItem('bottleName', name);
  document.getElementById('bottleNameDisplay').textContent = `æ°´ç“¶åç¨±ï¼š${name}`;
};

// æ›´æ–°ç•«é¢
function updateUI(){
  todayTotalEl.textContent=todayTotal;
  const percent=Math.min(100,(todayTotal/goal)*100);
  progressBar.style.width=percent+'%';
  if(todayTotal>=1000 && todayTotal%1000<lastInput){ // ç´¯ç©1000mlæ¾†èŠ±
    flowers++;
    const flowerEl=document.createElement('span');
    flowerEl.textContent='ğŸŒ¸';
    garden.appendChild(flowerEl);
  }
  if(todayTotal>=goal){
    badgeCount=1; streak++; level++;
  }
  badgeEl.textContent=badgeCount;
  streakEl.textContent=streak;
  levelEl.textContent=level;
  updateChart();
}

// Chart.js å–æ°´åˆ†å¸ƒåœ–
const ctx=document.getElementById('dailyChart');
let chart=new Chart(ctx,{
  type:'bar',
  data:{labels:[],datasets:[{label:'å–æ°´é‡(ml)',data:[],backgroundColor:'#3b82f6'}]},
  options:{responsive:true,maintainAspectRatio:false,scales:{y:{beginAtZero:true}}}
});

function updateChart(){
  chart.data.labels = waterHistory.map(i=>i.time);
  chart.data.datasets[0].data = waterHistory.map(i=>i.value);
  chart.update();
}

// åˆå§‹åŒ–
const savedName = localStorage.getItem('bottleName');
if(savedName) document.getElementById('bottleNameDisplay').textContent = `æ°´ç“¶åç¨±ï¼š${savedName}`;
updateUI();
</script>
</body>
</html>
