<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>WaterHero v3.4 — 每日喝水紀錄（最終穩定版）</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
* { box-sizing: border-box; }
body { margin:0; padding:0; overflow-x:hidden; display:flex; justify-content:center; min-height:100vh; width:100%; }
.glass { backdrop-filter: blur(6px); background: rgba(255,255,255,0.65); }
.dark .glass { background: rgba(17,24,39,0.55); }
.badge-anim { width: 92px; height: 92px; }
.progress-wave { background: linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0)); }

.water-bucket-wrapper { position: relative; width: 80px; height: 150px; border-radius:5px 5px 20px 20px; overflow:hidden; }
.bucket-outline { position:absolute; top:0; left:0; width:100%; height:100%; border:5px solid #a0a0a0; border-top:10px solid #888; border-radius:5px 5px 20px 20px; pointer-events:none; }
.water-level { position:absolute; bottom:0; left:0; width:100%; height:0%; background: linear-gradient(to top,#007bff,#4dc3ff); transition:height 0.8s ease-out; border-radius:0 0 15px 15px; }
.flower-garden { display:flex; flex-wrap:wrap; justify-content:center; align-content:flex-start; width:100%; height:150px; overflow-y:auto; padding:5px; border-radius:10px; margin-bottom:10px; border:1px dashed #c4d7e9; background:#f7fff7; }
.dark .flower-garden { background:#1a202c; border-color:#4a5568; }
.flower-unit { font-size:2em; margin:3px; line-height:1; }
#toast { position:fixed; right:20px; bottom:24px; z-index:9999; display:flex; flex-direction:column; gap:8px; max-width:90%; }
.toast-item { background: rgba(0,0,0,0.8); color:#fff; padding:10px 14px; border-radius:8px; font-size:14px; }
.btn-row { display:flex; gap:0.5rem; width:100%; margin-top:0.5rem; }
.btn-row button { padding-left:0.75rem; padding-right:0.75rem; flex-grow:1; flex-basis:0; }
</style>
</head>

<body class="bg-gradient-to-b from-sky-50 to-white dark:from-slate-900 dark:to-slate-800 text-slate-800 dark:text-slate-100 min-h-screen">

<div id="toast"></div>

<div class="max-w-3xl mx-auto p-4">
<header class="flex items-center justify-between mb-6">
  <div><h1 class="text-2xl font-semibold">WaterHero v3.4 💧</h1></div>
  <div class="flex items-center gap-3"><button id="notifyBtn" class="px-3 py-2 rounded-lg glass">提醒</button></div>
</header>

<main class="grid gap-4 md:grid-cols-2">
  <!-- 喝水輸入區 -->
  <form id="addForm" onsubmit="event.preventDefault();" class="md:col-span-2">
    <section class="p-4 rounded-2xl glass shadow">
      <div class="flex justify-between items-center mb-3">
        <div>
          <div class="text-sm text-slate-500 dark:text-slate-300">今日目標</div>
          <div class="text-xl font-bold"><span id="goalDisplay">2000</span> <span id="unitLabel">ml</span></div>
        </div>
        <div class="text-right">
          <div class="text-sm text-slate-500 dark:text-slate-300">已喝</div>
          <div class="text-xl font-bold"><span id="todayTotal">0</span> <span id="unitLabel2">ml</span></div>
        </div>
      </div>

      <div class="w-full text-center text-sm mb-3">
        <p class="font-medium text-slate-600 dark:text-slate-300">下次提醒倒數:</p>
        <div id="timerDisplay" class="text-lg font-bold text-sky-500">--:--:--</div>
      </div>

      <div class="w-full h-4 rounded-full bg-slate-200 dark:bg-slate-700 overflow-hidden mb-3">
        <div id="progressBar" class="h-full bg-sky-400 dark:bg-sky-500 text-right progress-wave" style="width:0%"></div>
      </div>

      <div class="flex flex-col gap-3">
        <div class="flex items-center gap-3">
          <input id="addInput" type="number" placeholder="輸入喝水量 (例如 250)" class="flex-1 p-3 rounded-lg border border-slate-200 dark:bg-slate-800">
          <select id="unitSelect" class="p-3 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800">
            <option value="ml">ml</option>
            <option value="cup">杯 (250ml)</option>
          </select>
        </div>
        <div class="btn-row">
          <button id="addBtn" class="bg-sky-600 text-white py-3 rounded-lg">加入</button>
          <button id="undoBtn" class="bg-red-500 text-white py-3 rounded-lg" title="撤銷上一筆記錄">撤銷 ↶</button>
        </div>
      </div>
    </section>
  </form>

  <!-- 澆花挑戰 -->
  <section class="p-4 rounded-2xl glass shadow">
    <h3 class="font-semibold text-lg mb-3 text-center">💧 澆花挑戰：累積與成長</h3>
    <div class="flex justify-around items-end h-48">
      <div class="water-bucket-wrapper">
        <div id="waterLevel" class="water-level"></div>
        <div class="bucket-outline"></div>
      </div>
      <div class="w-2/3 flex flex-col items-center justify-end h-full">
        <div id="flowerGarden" class="flower-garden"></div>
        <button id="waterFlowerBtn" disabled class="w-full px-4 py-2 rounded-lg bg-green-600 text-white disabled:bg-slate-400 disabled:cursor-not-allowed mt-2">💧 澆花 (1000ml)</button>
      </div>
    </div>
  </section>

  <!-- 水瓶與徽章 -->
  <section class="p-4 rounded-2xl glass shadow grid gap-3">
    <h3 class="font-semibold text-lg text-center">🏆 水瓶與徽章</h3>
    <div class="flex items-center gap-3">
      <input id="bottleName" class="flex-1 p-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800" placeholder="為你的水瓶命名">
      <button id="bottleSaveBtn" class="bg-sky-600 text-white py-2 px-3 rounded-lg">確定</button>
    </div>
    <div id="bottleNameDisplay" class="text-center mt-2 font-medium"></div>
    <div class="flex justify-around mt-3">
      <button id="resetToday" class="bg-yellow-400 text-white py-2 px-3 rounded-lg">重設今日</button>
      <button id="resetAll" class="bg-red-500 text-white py-2 px-3 rounded-lg">重設所有</button>
    </div>
  </section>
</main>
</div>

<script>
let todayTotal=0, bucketWater=0, lastInput=0, flowerCount=0, bottleName='', reminderTimer=null, reminderSeconds=0, goal=2000;

const addInputEl=document.getElementById('addInput');
const unitSelectEl=document.getElementById('unitSelect');
const addBtnEl=document.getElementById('addBtn');
const undoBtnEl=document.getElementById('undoBtn');
const waterFlowerBtnEl=document.getElementById('waterFlowerBtn');
const waterLevelEl=document.getElementById('waterLevel');
const flowerGardenEl=document.getElementById('flowerGarden');
const todayTotalEl=document.getElementById('todayTotal');
const progressBarEl=document.getElementById('progressBar');
const bottleInputEl=document.getElementById('bottleName');
const bottleSaveBtnEl=document.getElementById('bottleSaveBtn');
const bottleNameDisplayEl=document.getElementById('bottleNameDisplay');
const timerDisplayEl=document.getElementById('timerDisplay');
const notifyBtnEl=document.getElementById('notifyBtn');
const resetTodayEl=document.getElementById('resetToday');
const resetAllEl=document.getElementById('resetAll');

// UI更新
function updateUI(){
    todayTotalEl.textContent=todayTotal;
    waterLevelEl.style.height = Math.min(bucketWater/1000*100,100)+'%';
    progressBarEl.style.width=Math.min(todayTotal/goal*100,100)+'%';
}

// 加入喝水
addBtnEl.addEventListener('click', ()=>{
    let val=Number(addInputEl.value)||0;
    if(unitSelectEl.value==='cup') val*=250;
    if(val<=0) return;
    todayTotal+=val;
    lastInput=val;
    bucketWater+=val;
    if(bucketWater>=1000) waterFlowerBtnEl.disabled=false;
    addInputEl.value='';
    updateUI();
});

// 撤回
undoBtnEl.addEventListener('click', ()=>{
    todayTotal-=lastInput;
    bucketWater-=lastInput;
    if(bucketWater<1000) waterFlowerBtnEl.disabled=true;
    lastInput=0;
    updateUI();
});

// 澆花
waterFlowerBtnEl.addEventListener('click', ()=>{
    if(bucketWater>=1000){
        bucketWater-=1000;
        flowerCount++;
        const flower=document.createElement('div');
        flower.className='flower-unit';
        flower.textContent='🌸';
        flowerGardenEl.appendChild(flower);
        waterFlowerBtnEl.disabled=true;
        updateUI();
    }
});

// 水瓶命名
bottleSaveBtnEl.addEventListener('click', ()=>{
    let name=bottleInputEl.value.trim();
    if(name!==''){
        bottleName=name;
        bottleNameDisplayEl.textContent='水瓶名稱：'+bottleName;
        bottleInputEl.value='';
    }
});

// 提醒倒數
function startReminder(seconds){
    reminderSeconds=seconds;
    clearInterval(reminderTimer);
    reminderTimer=setInterval(()=>{
        if(reminderSeconds<=0){
            clearInterval(reminderTimer);
            timerDisplayEl.textContent='提醒時間到！';
            alert('喝水時間到！💧');
            return;
        }
        let h=Math.floor(reminderSeconds/3600);
        let m=Math.floor((reminderSeconds%3600)/60);
        let s=reminderSeconds%60;
        timerDisplayEl.textContent=`${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
        reminderSeconds--;
    },1000);
}

notifyBtnEl.addEventListener('click', ()=>{
    let min=prompt('請輸入提醒間隔（分鐘）：',60);
    min=Number(min)||60;
    startReminder(min*60);
});

// 重設今日
resetTodayEl.addEventListener('click', ()=>{
    todayTotal=0; bucketWater=0; lastInput=0; flowerCount=0;
    flowerGardenEl.innerHTML='';
    timerDisplayEl.textContent='--:--:--';
    clearInterval(reminderTimer);
    updateUI();
});

// 重設所有
resetAllEl.addEventListener('click', ()=>{
    let val=prompt('輸入 yes 確認重設所有資料:');
    if(val==='yes'){
        todayTotal=0; bucketWater=0; lastInput=0; flowerCount=0; bottleName='';
        flowerGardenEl.innerHTML='';
        bottleNameDisplayEl.textContent='';
        timerDisplayEl.textContent='--:--:--';
        clearInterval(reminderTimer);
        updateUI();
    }
});

updateUI();
</script>

</body>
</html>
