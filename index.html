<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>WaterHero v6.0 — 每日喝水紀錄（手機單頁優化版）</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  padding:0;
  overflow-x:hidden;
  background:linear-gradient(to bottom,#dbeafe,#f0fdf4);
  font-family:system-ui, -apple-system, BlinkMacSystemFont;
}
.container{
  max-width:480px;
  margin:0 auto;
  padding:1rem;
}
.section{
  @apply bg-white rounded-2xl shadow p-4 mb-4;
}
.btn{
  @apply bg-blue-500 text-white rounded-xl px-3 py-2 text-sm font-semibold active:scale-95;
}
input{
  @apply border border-gray-300 rounded-xl px-2 py-1 text-center text-sm;
}
</style>
</head>

<body>
<div class="container">

  <!-- 水瓶命名 -->
  <div class="section text-center">
    <h2 class="text-lg font-bold mb-2">💧 我的水瓶</h2>
    <div class="flex justify-center items-center gap-2">
      <input id="bottleName" type="text" placeholder="輸入水瓶名稱" class="w-36" />
      <button id="confirmBottle" class="btn">確認</button>
    </div>
    <p id="bottleDisplay" class="mt-2 text-blue-700 font-semibold"></p>
  </div>

  <!-- 喝水輸入 -->
  <div class="section text-center">
    <h2 class="text-lg font-bold mb-2">🥤 今日喝水量</h2>
    <div class="flex justify-center items-center gap-2 mb-2">
      <input id="addInput" type="number" placeholder="ml" class="w-24" />
      <button id="addBtn" class="btn">加入</button>
      <button id="undoBtn" class="btn bg-gray-500">撤回</button>
    </div>
    <p id="todayTotal" class="text-lg font-semibold text-blue-600">0 ml</p>
  </div>

  <!-- 澆花花園 -->
  <div class="section text-center">
    <h2 class="text-lg font-bold mb-2">🌷 我的花園</h2>
    <div id="flowerGarden" class="flex flex-wrap justify-center gap-2 min-h-[60px]"></div>
    <button id="waterFlowerBtn" class="btn mt-3">澆花 (需1000ml)</button>
  </div>

  <!-- 提醒與目標設定 -->
  <div class="section text-center">
    <h2 class="text-lg font-bold mb-2">⏰ 提醒與目標</h2>
    <div class="flex flex-wrap justify-center gap-3">
      <div class="flex items-center gap-1">
        <label class="text-sm">提醒(分)</label>
        <input id="reminderMins" type="number" placeholder="60" class="w-24" />
      </div>
      <button id="startReminder" class="btn">開始倒數</button>
      <div id="timerDisplay" class="font-semibold text-blue-600">--:--:--</div>
    </div>

    <div class="flex justify-center items-center gap-2 mt-4">
      <label class="text-sm">每日目標(ml)</label>
      <input id="dailyGoal" type="number" placeholder="2000" class="w-16" />
    </div>
  </div>

  <!-- 徽章與等級 -->
  <div class="section text-center">
    <h2 class="text-lg font-bold mb-2">🏅 成就</h2>
    <p id="badgeDisplay" class="text-yellow-600 font-semibold mb-1">尚未達標</p>
    <p id="levelDisplay" class="text-green-600 font-semibold">等級 Lv.1</p>
  </div>

  <!-- 今日分布圖 -->
  <div class="section text-center">
    <h2 class="text-lg font-bold mb-2">📊 今日喝水分布</h2>
    <canvas id="todayChart" height="200"></canvas>
  </div>

  <!-- 控制區 -->
  <div class="section text-center">
    <h2 class="text-lg font-bold mb-2">⚙️ 控制</h2>
    <div class="flex flex-wrap justify-center gap-2">
      <button id="resetToday" class="btn bg-red-500">重設今日</button>
      <button id="resetAll" class="btn bg-red-700">重設全部</button>
    </div>
  </div>

</div>

<script>
let total = 0, goal = 2000, flowers = 0, last = 0, level = 1, xp = 0, badges = 0;
const garden = document.getElementById('flowerGarden');
const totalEl = document.getElementById('todayTotal');
const badgeEl = document.getElementById('badgeDisplay');
const levelEl = document.getElementById('levelDisplay');
const goalInput = document.getElementById('dailyGoal');
const reminderInput = document.getElementById('reminderMins');
const timerEl = document.getElementById('timerDisplay');
let timer = null, secs = 0;
let chart, chartData = [];

function render() {
  totalEl.textContent = total + ' ml';
  badgeEl.textContent = (total >= goal) ? '🎖️ 今日達標！' : '尚未達標';
  levelEl.textContent = '等級 Lv.' + level;
}
function addWater(v) {
  total += v; last = v;
  chartData.push({t:new Date().toLocaleTimeString(),v});
  if(total >= goal){xp++; if(xp>=3){level++;xp=0;}}
  if(total >= 1000){flowers++; garden.innerHTML += '🌸'; total -= 1000;}
  render(); updateChart();
}
function undo(){ if(last>0){ total -= last; last=0; render(); updateChart();}}
function resetToday(){ if(confirm('重設今日紀錄？')){total=0;chartData=[];render();updateChart();}}
function resetAll(){
  let ok=prompt('輸入 yes 以重設全部資料');
  if(ok==='yes'){localStorage.clear();location.reload();}
}
function startReminder(){
  if(timer) clearInterval(timer);
  secs = Number(reminderInput.value)*60;
  timer = setInterval(()=>{
    if(secs<=0){clearInterval(timer);alert('喝水時間到！');timerEl.textContent='--:--:--';return;}
    secs--;
    const m=Math.floor(secs/60), s=secs%60;
    timerEl.textContent=`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  },1000);
}
function updateChart(){
  const ctx=document.getElementById('todayChart');
  const labels=chartData.map(i=>i.t);
  const data=chartData.map(i=>i.v);
  if(chart) chart.destroy();
  chart=new Chart(ctx,{type:'bar',data:{labels,datasets:[{label:'喝水(ml)',data}]},options:{responsive:true,maintainAspectRatio:false}});
}

document.getElementById('addBtn').onclick=()=>{const v=Number(document.getElementById('addInput').value);if(v>0)addWater(v);}
document.getElementById('undoBtn').onclick=undo;
document.getElementById('waterFlowerBtn').onclick=()=>{if(total>=1000){flowers++;garden.innerHTML+='🌸';total-=1000;render();}};
document.getElementById('resetToday').onclick=resetToday;
document.getElementById('resetAll').onclick=resetAll;
document.getElementById('startReminder').onclick=startReminder;
document.getElementById('confirmBottle').onclick=()=>{const n=document.getElementById('bottleName').value;document.getElementById('bottleDisplay').textContent='🏺 '+n;localStorage.setItem('bottle',n);}
window.onload=()=>{const n=localStorage.getItem('bottle');if(n)document.getElementById('bottleDisplay').textContent='🏺 '+n;render();updateChart();}
</script>
</body>
</html>
