<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>WaterHero v3.1 — 每日喝水紀錄（手機優先版）</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lottie-web@5.10.1/build/player/lottie.min.js"></script>

<style>
  * {
    box-sizing: border-box;
  }
  html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow-x: hidden;
    background-color: #f3f4f6;
  }
  canvas {
    max-width: 100% !important;
    height: auto !important;
  }
  .glass {
    backdrop-filter: blur(8px);
    background: rgba(255, 255, 255, 0.7);
    border-radius: 1rem;
  }
</style>
</head>

<body class="flex flex-col items-center justify-start min-h-screen p-4">

  <!-- Header -->
  <header class="w-full max-w-md text-center mb-4">
    <h1 class="text-2xl font-bold text-blue-600">💧 WaterHero</h1>
    <p class="text-sm text-gray-500">每日喝水紀錄（手機優先版）</p>
  </header>

  <!-- Main Card -->
  <main class="w-full max-w-md glass p-4 shadow-md flex flex-col gap-4">

    <!-- Progress -->
    <section class="w-full text-center">
      <h2 class="text-lg font-semibold mb-1">今日進度</h2>
      <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
        <div id="progressBar" class="bg-blue-500 h-4 rounded-full" style="width: 0%;"></div>
      </div>
      <p class="text-sm mt-1" id="progressText">0 / 2000 ml</p>
    </section>

    <!-- Input -->
    <section class="flex items-center justify-between gap-2">
      <input id="inputWater" type="number" placeholder="輸入喝水量 (ml)" class="flex-1 border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-400">
      <button id="addBtn" class="bg-blue-500 text-white px-4 py-2 rounded-lg active:scale-95">新增</button>
    </section>

    <!-- Chart -->
    <section class="w-full">
      <h2 class="text-lg font-semibold mb-1">過去七天</h2>
      <div class="w-full overflow-hidden">
        <canvas id="waterChart"></canvas>
      </div>
    </section>

  </main>

  <!-- Footer -->
  <footer class="text-xs text-gray-400 mt-4 mb-2">© 2025 WaterHero</footer>

<script>
  const goal = 2000;
  let todayKey = new Date().toISOString().split("T")[0];
  let data = JSON.parse(localStorage.getItem("waterData") || "{}");

  if (!data[todayKey]) data[todayKey] = 0;

  const progressBar = document.getElementById("progressBar");
  const progressText = document.getElementById("progressText");
  const inputWater = document.getElementById("inputWater");
  const addBtn = document.getElementById("addBtn");
  const ctx = document.getElementById("waterChart").getContext("2d");

  function updateProgress() {
    const total = data[todayKey];
    const percent = Math.min((total / goal) * 100, 100);
    progressBar.style.width = percent + "%";
    progressText.textContent = `${total} / ${goal} ml`;
    localStorage.setItem("waterData", JSON.stringify(data));
  }

  function updateChart() {
    const labels = [];
    const values = [];
    for (let i = 6; i >= 0; i--) {
      const d = new Date();
      d.setDate(d.getDate() - i);
      const key = d.toISOString().split("T")[0];
      labels.push(d.getMonth() + 1 + "/" + d.getDate());
      values.push(data[key] || 0);
    }

    if (window.waterChart) window.waterChart.destroy();
    window.waterChart = new Chart(ctx, {
      type: "bar",
      data: {
        labels,
        datasets: [{
          label: "喝水量 (ml)",
          data: values,
          borderRadius: 8,
          backgroundColor: "#3b82f6"
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: { beginAtZero: true, max: goal }
        },
        plugins: {
          legend: { display: false }
        }
      }
    });
  }

  addBtn.addEventListener("click", () => {
    const val = parseInt(inputWater.value);
    if (isNaN(val) || val <= 0) return;
    data[todayKey] += val;
    inputWater.value = "";
    updateProgress();
    updateChart();
  });

  window.addEventListener("resize", updateChart);

  updateProgress();
  updateChart();
</script>
</body>
</html>
