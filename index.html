<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>WaterHero v4.0 — 手機單頁最終版</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
* { box-sizing:border-box; }
body { margin:0; padding:0; width:100%; min-height:100vh; display:flex; justify-content:center; background:linear-gradient(180deg,#f0f9ff,#eef2ff); color:#0f172a; font-family:system-ui; }
.glass { backdrop-filter: blur(6px); background:rgba(255,255,255,0.65); border-radius:14px; }
.dark .glass { background: rgba(17,24,39,0.55); color:#e6eef8; }
.btn-row { display:flex; gap:0.5rem; width:100%; margin-top:0.5rem; }
.btn-row button { flex-grow:1; flex-basis:0; padding:0.75rem; border-radius:0.75rem; }
.water-bucket-wrapper { position:relative; width:72px; height:140px; border-radius:6px 6px 18px 18px; overflow:hidden; }
.bucket-outline { position:absolute; inset:0; border:4px solid #9aa6b2; border-top-width:10px; border-radius:6px 6px 18px 18px; pointer-events:none; }
.water-level { position:absolute; bottom:0; left:0; width:100%; height:0%; background:linear-gradient(180deg,#60a5fa,#93c5fd); transition:height 0.6s ease; border-radius:0 0 14px 14px; }
.flower-garden { display:flex; flex-wrap:wrap; justify-content:center; align-content:flex-start; width:100%; height:150px; overflow-y:auto; padding:5px; border-radius:10px; margin-bottom:10px; border:1px dashed #c4d7e9; background:#f7fff7; }
.flower-unit { font-size:1.6rem; margin:4px; display:inline-block; }
</style>
</head>
<body>

<div class="w-full max-w-md p-4">

  <header class="flex justify-between mb-4">
    <h1 class="text-xl font-bold">WaterHero v4.0</h1>
    <button id="notifyBtn" class="glass px-3 py-2 rounded-lg">提醒</button>
  </header>

  <!-- 今日目標 / 進度 -->
  <section class="glass p-4 rounded-2xl shadow mb-4">
    <div class="flex justify-between mb-2">
      <div>今日目標<br><span id="goalDisplay" class="font-bold text-lg">2000</span> ml</div>
      <div>已喝<br><span id="todayTotal" class="font-bold text-lg">0</span> ml</div>
    </div>
    <div class="w-full h-3 bg-slate-200 rounded-full overflow-hidden mb-2">
      <div id="progressBar" class="h-full bg-sky-500" style="width:0%"></div>
    </div>
    <div class="flex justify-between">
      <span class="text-sm">下次提醒倒數</span>
      <span id="timerDisplay" class="font-medium text-sky-600">--:--:--</span>
    </div>
  </section>

  <!-- 喝水輸入 -->
  <section class="glass p-4 rounded-2xl shadow mb-4">
    <div class="flex gap-2 mb-2">
      <input id="addInput" type="number" placeholder="輸入喝水量" class="flex-1 p-2 border rounded-lg">
      <select id="unitSelect" class="p-2 border rounded-lg">
        <option value="ml">ml</option>
        <option value="cup">杯 (250ml)</option>
      </select>
    </div>
    <div class="btn-row">
      <button id="addBtn" class="bg-sky-600 text-white">加入</button>
      <button id="undoBtn" class="bg-red-500 text-white">撤回</button>
    </div>
  </section>

  <!-- 澆花 -->
  <section class="glass p-4 rounded-2xl shadow mb-4">
    <h3 class="text-center font-semibold mb-2">💧 澆花挑戰</h3>
    <div class="flex gap-4 items-end">
      <div class="water-bucket-wrapper">
        <div id="waterLevel" class="water-level"></div>
        <div class="bucket-outline"></div>
      </div>
      <div class="flex-1">
        <div id="flowerGarden" class="flower-garden"></div>
        <button id="waterFlowerBtn" class="w-full bg-green-600 text-white py-2 rounded-lg mt-2" disabled>澆花 (1000ml)</button>
        <div class="text-sm mt-1">桶內水量：<span id="bucketDisplay">0</span> ml</div>
      </div>
    </div>
  </section>

  <!-- 水瓶命名 -->
  <section class="glass p-4 rounded-2xl shadow mb-4">
    <div class="mb-2 text-sm">水瓶名稱</div>
    <div class="flex gap-2">
      <input id="bottleName" class="flex-1 p-2 border rounded-lg" placeholder="命名你的水瓶">
      <button id="bottleSaveBtn" class="bg-green-600 text-white py-2 px-3 rounded-lg">確定</button>
    </div>
    <div class="mt-2 text-sm" id="bottleNameDisplay"></div>
  </section>

  <!-- 重設 / 匯出 -->
  <section class="glass p-4 rounded-2xl shadow mb-4 flex flex-col gap-2">
    <button id="resetToday" class="bg-amber-400 py-2 rounded-lg text-white">重設今日</button>
    <button id="resetAll" class="bg-red-600 py-2 rounded-lg text-white">重設所有 (輸入 yes 驗證)</button>
    <button id="exportBtn" class="bg-slate-300 py-2 rounded-lg">匯出資料</button>
  </section>

  <!-- 七日趨勢 -->
  <section class="glass p-4 rounded-2xl shadow mb-4">
    <h3 class="font-semibold text-center mb-2">過去 7 天紀錄</h3>
    <canvas id="weekChart" style="height:160px;"></canvas>
    <div id="historyList" class="text-sm mt-2"></div>
  </section>

</div>

<script>
// 簡單資料存儲
let todayTotal = 0, bucketWater = 0, bucketLimit = 1000, lastInput = 0, flowerCount = 0;
let goal = 2000; let bottleName = '';
const addInput = document.getElementById('addInput');
const unitSelect = document.getElementById('unitSelect');
const addBtn = document.getElementById('addBtn');
const undoBtn = document.getElementById('undoBtn');
const waterFlowerBtn = document.getElementById('waterFlowerBtn');
const waterLevel = document.getElementById('waterLevel');
const bucketDisplay = document.getElementById('bucketDisplay');
const flowerGarden = document.getElementById('flowerGarden');
const goalDisplay = document.getElementById('goalDisplay');
const todayTotalDisplay = document.getElementById('todayTotal');
const bottleInput = document.getElementById('bottleName');
const bottleSaveBtn = document.getElementById('bottleSaveBtn');
const bottleNameDisplay = document.getElementById('bottleNameDisplay');

// 加水
addBtn.addEventListener('click', () => {
  let val = Number(addInput.value) || 0;
  if(unitSelect.value==='cup') val *=250;
  todayTotal += val;
  lastInput = val;
  bucketWater += val;
  if(bucketWater>=bucketLimit) waterFlowerBtn.disabled=false;
  updateUI();
  add
